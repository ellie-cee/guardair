{% comment %}
  new-title.liquid
  
  Usage: {% render 'new-title', title: 'Your Title String Here', remove_after_dash: true %}
  
  Parameters:
  - title: The string to process
  - remove_after_dash: true/false - whether to remove everything after dash (default: true)
  
  Rules applied:
  1. Remove everything after dash (-) - optional based on remove_after_dash parameter
  2. Remove specific words like "The" and "Classic+"
  3. Remove specific special characters (trademark, registered, etc.)
{% endcomment %}

{%- liquid
  assign processed_title = title
  
  assign found_model = ''
  assign model_removed_title = ''
    
  if remove_after_dash == blank
    assign remove_after_dash = true
  endif
-%}

{% comment %} Step 1: Remove specific words {% endcomment %}
{%- liquid
  assign words_to_remove = 'The,Classic+,the,THE,classic+,CLASSIC+,F5'
  assign words_array = words_to_remove | split: ','
  
  for word in words_array
    assign clean_title = processed_title | replace: word, ''
  endfor
-%}

{% comment %} Step 4: Remove specific special characters (trademark, registered, etc.) {% endcomment %}
{%- liquid
  assign special_chars = '®,™,©,℠'
  assign special_chars_array = special_chars | split: ','
  
  for special_char in special_chars_array
    assign clean_title = clean_title | replace: special_char, ''
  endfor
-%}

{% comment %} Step 1: Handle model numbers if change_model is specified {% endcomment %}
{%- liquid
  if change_model == 'remove' or change_model == 'move' or change_model == 'get_series'
    # Split title into words to find model number
    assign words = clean_title | split: ' '
    assign model_pattern_found = false
    
    for word in words
      # Skip if word contains quote mark (it's a size measurement)
      unless word contains '"' or word contains "'"
        # Check if word matches model number pattern (digits + 1-2 letters)
        assign word_size = word | size
        assign has_digits = false
        assign has_letters = false
        assign letter_count = 0
        assign digit_count = 0
        
        # Simple pattern check - look for words with both numbers and letters
        if word contains '0' or word contains '1' or word contains '2' or word contains '3' or word contains '4' or word contains '5' or word contains '6' or word contains '7' or word contains '8' or word contains '9'
          assign has_digits = true
          # Count approximate digits by checking for common digit patterns
          assign temp_word = word
          assign temp_word = temp_word | replace: '0', ''
          assign temp_word = temp_word | replace: '1', ''
          assign temp_word = temp_word | replace: '2', ''
          assign temp_word = temp_word | replace: '3', ''
          assign temp_word = temp_word | replace: '4', ''
          assign temp_word = temp_word | replace: '5', ''
          assign temp_word = temp_word | replace: '6', ''
          assign temp_word = temp_word | replace: '7', ''
          assign temp_word = temp_word | replace: '8', ''
          assign temp_word = temp_word | replace: '9', ''
          assign remaining_size = temp_word | size
          assign digit_count = word_size | minus: remaining_size
        endif
        
        # Check if remaining characters are letters (and not too many)
        if has_digits and remaining_size > 0 and remaining_size <= 2 and digit_count >= 1
          # This looks like a model number pattern
          assign found_model = word
          assign model_pattern_found = true
          break
        endif
      endunless
    endfor
    endif
-%}


{% comment %} Step 7: Display Series {% endcomment %}
{%- liquid
  if change_model == 'get_series'
    assign series = found_model    
    assign clean_title = found_model
  endif
-%}    
{% comment %} Step 7: Display Differentiator {% endcomment %}
{%- liquid
  if change_model == 'get_diff'
    if title contains 'w/'
      assign diff_split = title | split: 'w/'
      assign clean_title = diff_split | last
      assign differentiator = diff_split | last
    else
        assign clean_title = ''
    endif
  endif
-%} 

{% comment %} Step 7: Display Size {% endcomment %}
{%- liquid
  if change_model == 'get_size'
    if title contains '"'
      assign size_split = title | split: '"'
      assign size_first = size_split | first
      assign size_last = size_split | last    
      assign clean_title = size_first | append:'"'  
      if clean_title contains ' - '
          assign size_split = clean_title | split: ' - '
          assign clean_title = size_split | last
      endif
        if size_last contains ' x ' 
           assign clean_title = clean_title |  append: size_last | append:'"'
        endif
       assign size = clean_title
    else
        assign clean_title = ''
    endif
  endif
-%} 

{% if text_style and text_style == 'basic_series' %}
  {% assign clean_title = series %}
{% endif %}
{% comment %} Step 7: Final cleanup and assign result to output variable {% endcomment %}
  {% assign clean_title = clean_title | replace: '  ', ' ' | replace: '   ', ' ' | strip %}
  {% assign value_needed = clean_title %}

{{ value_needed }}
 {% comment %}   
    # Remove the model number from the title
    if model_pattern_found
      assign model_removed_title = clean_title | replace: found_model, ''
      assign clean_title = model_removed_title
    endif
  endif
{% endcomment %}

{% comment %} Step 2: Remove everything after dash (including the dash) - conditional  
  if remove_after_dash and processed_title contains '-'
    assign dash_position = processed_title | split: '-' | first
    assign processed_title = dash_position
  endif
{% endcomment %}

{% comment %} Step 2b: Remove everything after with - conditional {% endcomment %}
{% comment %}
  if remove_after_dash and processed_title contains 'w/'
    assign dash_position = processed_title | split: 'w/' | first
    assign processed_title = dash_position
  endif
{% endcomment %}


{% comment %} Step 6: Handle model number positioning {% endcomment %}
{% comment %} 
  {% if change_model == 'move' and found_model != '' %}
    {% assign clean_title = found_model | append: ' ' | append: clean_title %}
  {% endif %}
{% endcomment %}