{% comment %}
  new-title.liquid
  
  Usage: {% render 'new-title', title: 'Your Title String Here', remove_after_dash: true %}
  
  Parameters:
  - title: The string to process
  - remove_after_dash: true/false - whether to remove everything after dash (default: true)
  
  Rules applied:
  1. Remove everything after dash (-) - optional based on remove_after_dash parameter
  2. Remove specific words like "The" and "Classic+"
  3. Remove specific special characters (trademark, registered, etc.)
{% endcomment %}

{%- liquid
  assign processed_title = product.title
  
  assign model = ''
  assign plain_jane = true
  assign found_model = false       
  assign found_quote = false   
  assign found_diff = false   
  assign model_removed_title = ''
  assign type_subcat = false
    
  if remove_after_dash == blank
    assign remove_after_dash = true
  endif

-%}

{% comment %} Step 1: Remove specific words {% endcomment %}
{%- liquid
  assign words_to_remove = 'The,Classic+,the,THE,classic+,CLASSIC+,F5,(Sold by the Foot)'
  assign words_array = words_to_remove | split: ','
  
  for word in words_array
    assign clean_title = processed_title | replace: word, ''
  endfor
-%}

{% comment %} Step 4: Remove specific special characters (trademark, registered, etc.) {% endcomment %}
{% assign special_chars = '®,®,™,©,℠' %}
{% assign special_chars_array = special_chars | split: ',' %}
  
{% for special_char in special_chars_array %}
{% assign clean_title = clean_title | replace: special_char, '' %}
{% endfor %}

{% if clean_title contains '"' %}
    {% assign found_quote = true %}
{% endif %}
{% if clean_title contains '"' %}
    {% assign found_quote = true %}
{% endif %}
{% comment %} Step 1: Handle model numbers if change_model is specified {% endcomment %}
{% comment %}Split title into words to find model number {% endcomment %}
  {% assign words = clean_title | split: ' ' %}
    
  {% for word in words %}
      {% comment %}Skip if word contains quote mark (it's a size measurement) {% endcomment %}
        {% unless word contains '"' or word contains "'" %}
            {% comment %}Check if word matches model number pattern (digits + 1-2 letters) {% endcomment %}
            {% assign word_size = word | size %}
            {% assign has_digits = false %}
            {% assign has_letters = false %}
            {% assign letter_count = 0 %}
            {% assign digit_count = 0 %}
                  
          {% comment %}Simple pattern check - look for words with both numbers and letters {% endcomment %}
            {% if word contains '0' or word contains '1' or word contains '2' or word contains '3' or word contains '4' or word contains '5' or word contains '6' or word contains '7' or word contains '8' or word contains '9'  %}
                  {% assign has_digits = true %}
                {% comment %}Count approximate digits by checking for common digit patterns {% endcomment %}
                  {% assign temp_word = word %}
                  {% assign temp_word = temp_word | replace: '0', '' %}
                  {% assign temp_word = temp_word | replace: '1', '' %}
                  {% assign temp_word = temp_word | replace: '2', '' %}
                  {% assign temp_word = temp_word | replace: '3', '' %}
                  {% assign temp_word = temp_word | replace: '4', '' %}
                  {% assign temp_word = temp_word | replace: '5', '' %}
                  {% assign temp_word = temp_word | replace: '6', '' %}
                  {% assign temp_word = temp_word | replace: '7', '' %}
                  {% assign temp_word = temp_word | replace: '8', '' %}
                  {% assign temp_word = temp_word | replace: '9', '' %}
                  {% assign remaining_size = temp_word | size %}
                  {% assign digit_count = word_size | minus: remaining_size %}
            {% endif %}
                  
          {% comment %}Check if remaining characters are letters (and not too many) {% endcomment %}
            {% if has_digits and remaining_size > 0 and remaining_size <= 2 and digit_count >= 1 %}
                {% comment %}This looks like a model number pattern {% endcomment %}
                  {% assign model = word %}             
                  {% assign found_model = true %}
                  {% break %}
            {% endif %}
        {% endunless %}
  {% endfor %}


{% comment %} Step 7: Display Series {% endcomment %}
  {% if change_model == 'get_series' %}
      {% assign series = model    %}
{{ series }}
  {% endif%}
   

{% comment %} Step 7: Dispaly Family {% endcomment %}
  {% if change_model == 'get_family' %}
    {% assign family = clean_title | split: model | first %}
{{ family }}
  {% endif %}


{% comment %} Step 7: Display Differentiator {% endcomment %}
  {% if change_model == 'get_diff' %}
      {% if clean_title contains 'w/' %}
          {% assign diff_split = clean_title | split: 'w/' %}
          {% assign differentiator = diff_split | last %}
          {% assign found_diff = true %}
      {% else %}
          {% assign differentiator = '' %}
      {% endif %}
{{ differentiator }}
  {% endif %}
 
 {% if found_model or found_quote or found_diff %}
      {% assign plain_jane = false %}
   {% endif %}

   
{% comment %} Step 7: Display Size {% endcomment %}
    {% if clean_title contains '"' or clean_title contains 'Gallon' %}
       {% if clean_title contains '"' %}
            {% assign size_split = clean_title | split: '"' %}
             {% assign units = '"' %}
            {% assign size_first = size_split | first %}
            {% assign size_last = size_split | last %}
            {% assign size = size_first | append:units %}         
       {% elsif clean_title contains '5.5 Gallon' %}
            {% assign size = '5.5 Gallon' %}                  
       {% elsif clean_title contains 'Gallon' %}
            {% assign size_split = clean_title | split: 'Gallon' %}
             {% assign units = 'Gallon' %}
            {% assign size_first = size_split | first %}
            {% assign size_last = size_split | last %}
            {% assign size = size_first | append:units %}         
         {% else %}        
           {% assign size_split = '' %}
           {% assign units = '' %}
           {% assign size = '' %}         
       {% endif %}
              {% if size contains ' - ' %}
                {% assign size_split = size | split: ' - ' %}
                {% assign size = size_split | last %}
              {% endif %}
              {% if size_last contains ' x '  %}
                {% assign size = size |  append: size_last | append:'"' %}
              {% endif %}
    {% else %}
      {% assign size = '' %}
    {% endif %}
      {% assign size = size | strip %}
      
{% if change_model == 'get_size' %}{{- size -}}{% endif %}


{% if text_style and text_style == 'format1' %}
    {% if product.type == 'Vacuums' %}
        {% assign basic_series = clean_title | split: ' - ' | first %}
    {% elsif product.type == 'Parts & Accessories' and product.title contains ' - '  %} 
         {% assign basic_series = clean_title | remove: size | split: ' - ' |  first %}            
    {% elsif product.type == 'Parts & Accessories'  %} 
         {% assign basic_series = clean_title | remove: size %}         
    {% elsif product.type == 'Air Hoses & Fittings' and size != blank %}
         {% assign basic_series = clean_title | split: size | first %}  
    {% elsif product.type == 'Air Hoses & Fittings' %}
         {% assign basic_series = clean_title %}
    {% elsif plain_jane %}
        {% assign basic_series = clean_title | split: ' - ' | first %}
    {% else %}
        {% assign basic_series = clean_title | remove: model | remove: differentiator | remove: size %}      
    {% endif %}
      {% assign basic_series = basic_series | replace: '  ', ' ' | replace: '   ', ' ' | remove: '-' | strip %}  
      {{ basic_series }}  
{% endif %}


{% comment %} Step 7: Final cleanup and assign result to output variable {% endcomment %}
  {% assign clean_title = clean_title | replace: '  ', ' ' | replace: '   ', ' ' | strip %}

 {% comment %}   
    # Remove the model number from the title
    if model_pattern_found
      assign model_removed_title = clean_title | replace: found_model, ''
      assign clean_title = model_removed_title
    endif
  endif
{% endcomment %}

{% comment %} Step 2: Remove everything after dash (including the dash) - conditional  
  if remove_after_dash and processed_title contains '-'
    assign dash_position = processed_title | split: '-' | first
    assign processed_title = dash_position
  endif
{% endcomment %}

{% comment %} Step 2b: Remove everything after with - conditional {% endcomment %}
{% comment %}
  if remove_after_dash and processed_title contains 'w/'
    assign dash_position = processed_title | split: 'w/' | first
    assign processed_title = dash_position
  endif
{% endcomment %}


{% comment %} Step 6: Handle model number positioning {% endcomment %}
{% comment %} 
  {% if change_model == 'move' and found_model != '' %}
    {% assign clean_title = found_model | append: ' ' | append: clean_title %}
  {% endif %}
{% endcomment %}