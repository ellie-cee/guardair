{% comment %}
  new-title.liquid
  
  Usage: {% render 'new-title', title: 'Your Title String Here', remove_after_dash: true %}
  
  Parameters:
  - title: The string to process
  - remove_after_dash: true/false - whether to remove everything after dash (default: true)
  
  Rules applied:
  1. Remove everything after dash (-) - optional based on remove_after_dash parameter
  2. Remove specific words like "The" and "Classic+"
  3. Remove specific special characters (trademark, registered, etc.)
{% endcomment %}

{%- liquid
  assign processed_title = product.title
  
  assign model = ''
  assign plain_jane = true
  assign found_model = false   
  assign found_family = false 
  assign found_quote = false   
  assign found_diff = false   
    
  if remove_after_dash == blank
    assign remove_after_dash = true
  endif

-%}

{% comment %} Step X: Remove specific words {% endcomment %}
{% assign words_to_remove = 'The,Classic+,the,THE,classic+,CLASSIC+,F5,(Sold by the Foot)' %}
{% assign words_array = words_to_remove | split: ',' %}
  
{% for word in words_array %}
  {% assign clean_title = processed_title | replace: word, '' %}
{% endfor %}


{% comment %} Step X: Remove specific special characters (trademark, registered, etc.) {% endcomment %}
{% assign special_chars = '®,®,™,©,℠' %}
{% assign special_chars_array = special_chars | split: ',' %}
  
{% for special_char in special_chars_array %}
  {% if clean_title contains special_char %}{% assign found_special = true %}{% endif %}{% assign clean_title = clean_title | replace: special_char, '' %}
{% endfor %}

{% if clean_title contains '"' %}
    {% assign found_quote = true %}
{% endif %}
{% if clean_title contains '"' %}
    {% assign found_quote = true %}
{% endif %}

{% comment %} Step X: Find Family Name {% endcomment %}
{% assign families = 'Blind Hole,Contain-It Kit,GunVac,MachineVac,Material Mover,PowerQUAD' %}
{% assign families_array = families | split: ',' %}
  
{% for family_val in families_array %}
  {% if clean_title contains family_val %}{% assign found_family = true %}{% assign family = family_val %}{% endif %}
{% endfor %}

{% comment %} Step X: Handle model numbers if change_model is specified {% endcomment %}
{% comment %}Split title into words to find model number {% endcomment %}
  {% assign words = clean_title | split: ' ' %}
    
  {% for word in words %}
      {% comment %}Skip if word contains quote mark (it's a size measurement) {% endcomment %}
        {% unless word contains '"' or word contains "'" %}
            {% comment %}Check if word matches model number pattern (digits + 1-2 letters) {% endcomment %}
            {% assign word_size = word | size %}
            {% assign has_digits = false %}
            {% assign has_letters = false %}
            {% assign letter_count = 0 %}
            {% assign digit_count = 0 %}
                  
          {% comment %}Simple pattern check - look for words with both numbers and letters {% endcomment %}
            {% if word contains '0' or word contains '1' or word contains '2' or word contains '3' or word contains '4' or word contains '5' or word contains '6' or word contains '7' or word contains '8' or word contains '9'  %}
                  {% assign has_digits = true %}
                {% comment %}Count approximate digits by checking for common digit patterns {% endcomment %}
                  {% assign temp_word = word %}
                  {% assign temp_word = temp_word | replace: '0', '' %}
                  {% assign temp_word = temp_word | replace: '1', '' %}
                  {% assign temp_word = temp_word | replace: '2', '' %}
                  {% assign temp_word = temp_word | replace: '3', '' %}
                  {% assign temp_word = temp_word | replace: '4', '' %}
                  {% assign temp_word = temp_word | replace: '5', '' %}
                  {% assign temp_word = temp_word | replace: '6', '' %}
                  {% assign temp_word = temp_word | replace: '7', '' %}
                  {% assign temp_word = temp_word | replace: '8', '' %}
                  {% assign temp_word = temp_word | replace: '9', '' %}
                  {% assign remaining_size = temp_word | size %}
                  {% assign digit_count = word_size | minus: remaining_size %}
            {% endif %}
                  
          {% comment %}Check if remaining characters are letters (and not too many) {% endcomment %}
            {% if has_digits and remaining_size > 0 and remaining_size <= 2 and digit_count >= 1 %}
                {% comment %}This looks like a model number pattern {% endcomment %}
                  {% assign model = word %}             
                  {% assign found_model = true %}
                  {% break %}
            {% endif %}
        {% endunless %}
  {% endfor %}


{% comment %} SERIES {% endcomment %}
{% assign series = model %}

   

{% comment %} FAMILY {% endcomment %}
{% if found_family %}
  {% assign family2 = clean_title | append:'--' %}
{% elsif found_special %}
  {% assign family2 = clean_title | append:'--' %}
{% else %}
  {% assign family2 = clean_title | split: ' ' | first %}
{% endif %}


{% comment %} VARIANT {% endcomment %}
  {% if product.type == 'Air & Syphon Guns' and product.title contains '-' %} 
          {% assign var_split = clean_title | split: '-' %}
          {% assign variant = var_split | last %}
          {% assign variant_whole = variant | prepend:'-' %}
  {% else %}
          {% assign variant = '' %}
  {% endif %}

{% comment %} ASIDE {% endcomment %}
  {% if product.title contains '(' and product.title contains ')' %} 
          {% assign aside_end = clean_title | split: '(' | last %}
          {% assign aside = aside_split | split: ')' | first %}
          {% assign variant_whole = variant | prepend:'-' %}
          {% assign aside = aside_end %}
  {% else %}
          {% assign aside = '' %}
  {% endif %}


{% comment %} DIFFERENTIATOR {% endcomment %}
      {% if clean_title contains 'w/' %}
          {% assign diff_split = clean_title | split: 'w/' %}
          {% assign differentiator = diff_split | last %}
          {% assign differentiator_whole = differentiator | prepend:'w/' %}
          {% assign found_diff = true %}
      {% else %}
          {% assign differentiator = '' %}
      {% endif %}

 
{% if found_model or found_quote or found_diff %}
      {% assign plain_jane = false %}
{% endif %}

   
{% comment %} SIZE {% endcomment %}
    {% if clean_title contains '"' or clean_title contains 'Gallon' %}     
       {% if clean_title contains '5.5 Gallon' %}
            {% assign size = '5.5 Gallon' %}                  
       {% elsif clean_title contains 'Gallon' %}
            {% assign size_split = clean_title | split: 'Gallon' %}
             {% assign units = 'Gallon' %}
            {% assign size_first = size_split | first %}
            {% assign size_last = size_split | last %}
            {% assign size = size_first | append:units %}      
       {% elsif clean_title contains '"' %}
            {% assign size_split = clean_title | split: '"' %}
             {% assign units = '"' %}
            {% assign size_first = size_split | first %}
            {% assign size_last = size_split | last %}
            {% assign size = size_first | append:units %}                
         {% else %}        
           {% assign size_split = '' %}
           {% assign units = '' %}
           {% assign size = '' %}         
       {% endif %}
              {% if size contains ' - ' %}
                {% assign size_split = size | split: ' - ' %}
                {% assign size = size_split | last %}
              {% endif %}
              {% if size_last contains ' x '  %}
                {% assign units = clean_title | slice:-1  %}
                 {% assign size = size |  append: size_last %}
              {% elsif size contains '"' %}

              {% endif %}
    {% else %}
      {% assign size = '' %}
    {% endif %}
    {% if found_family %}
      {% assign size = size | remove:family | strip %}
    {% else %}
      {% assign size = size | strip %}
    {% endif %}


{% comment %} ---------- FORMAT 1 ---------- {% endcomment %}
{% if text_style and text_style == 'format1' %}
    {% if product.type == 'Vacuums' and size == '5.5 Gallon' %}
        {% assign basic_series = clean_title | split: ' - ' | first | remove: size %}
    {% elsif product.type == 'Vacuums' %}
        {% assign basic_series = clean_title | split: ' - ' | first | remove: differentiator_whole %}
    {% elsif product.type == 'Parts & Accessories' and product.title contains ' - '  %} 
         {% assign basic_series = clean_title | remove: size | split: ' - ' |  first %}            
    {% elsif product.type == 'Parts & Accessories'  %} 
         {% assign basic_series = clean_title | remove: size %}         
    {% elsif product.type == 'Air Hoses & Fittings' and size != blank %}
        {% assign temp_series = clean_title | split: size | first %}
        {% if temp_series.size == 0 %}{% assign basic_series = clean_title | split: ' - ' | first %}
        {% else %}{% assign basic_series = clean_title | split: size | first %}{% endif %}
    {% elsif product.type == 'Air Hoses & Fittings' %}
         {% assign basic_series = clean_title %}
    {% elsif product.type == 'Air & Syphon Guns'  %} 
         {% assign basic_series = clean_title | remove: variant | remove: size %}                 
    {% elsif plain_jane %}
        {% assign basic_series = clean_title | split: ' - ' | first %}
    {% else %}
        {% assign basic_series = clean_title | remove: model | remove: differentiator_whole | remove: size %}      
    {% endif %}
      {% assign basic_series = basic_series | replace: '  ', ' ' | replace: '   ', ' ' | remove: '-' | strip %}
      
      {% comment %} WEIRD OVERRIDES {% endcomment %}
    {% if found_family and size_position != 0 %}{% assign basic_series = basic_series | remove:size %}{% endif %}
    {% if basic_series contains 'Material Mover' %}{% assign basic_series = basic_series | append: ' Vacuum' %}{% endif %}
    {% if basic_series contains 'ContainIt Kit' %}{% assign basic_series = 'Contain-It Kit' %}{% endif %}
{{ basic_series }}


{% comment %} ---------- FORMAT 2 ---------- {% endcomment %}
  {% elsif text_style and text_style == 'format2' %}
    {% if product.type == 'Vacuums' and size == '5.5 Gallon' %}
        {% assign specific_series = clean_title | split: ' - ' | first | remove: size %}
    {% elsif product.type == 'Vacuums' %}
        {% assign specific_series = clean_title | split: ' - ' | first | remove: differentiator_whole %}
    {% elsif product.type == 'Parts & Accessories' and product.title contains ' - '  %} 
         {% assign specific_series = clean_title  | split: ' - ' |  first %}            
    {% elsif product.type == 'Parts & Accessories'  %} 
         {% assign specific_series = clean_title %}         
    {% elsif product.type == 'Air Hoses & Fittings' and size != blank %}
        {% assign temp_series = clean_title | split: size | first %}
        {% if temp_series.size == 0 %}{% assign specific_series = clean_title | split: ' - ' | first %}
        {% else %}{% assign specific_series = clean_title | split: size | first %}{% endif %}
    {% elsif product.type == 'Air Hoses & Fittings' %}
         {% assign specific_series = clean_title %}
    {% elsif product.type == 'Air & Syphon Guns'  %}
         {% assign specific_series = clean_title | remove: variant | remove: size | append: aside%}              
    {% elsif plain_jane %}
        {% assign specific_series = clean_title | split: ' - ' | first %}
    {% else %}
        {% assign specific_series = clean_title | remove: model | remove: differentiator_whole  %}      
    {% endif %}
      {% assign specific_series = specific_series | replace: '  ', ' ' | replace: '   ', ' ' | remove: '-' | strip %}
      
      {% comment %} WEIRD OVERRIDES {% endcomment %}
    {% if found_family and size_position != 0 %}{% assign specific_series = specific_series %}{% endif %}
    {% if specific_series contains 'Material Mover' %}{% assign specific_series = specific_series | append: ' Vacuum' %}{% endif %}
{{ specific_series }}  <br>-{{ aside }}

{% endif %}


{% comment %} Step 7: Final cleanup and assign result to output variable {% endcomment %}
  {% assign clean_title = clean_title | replace: '  ', ' ' | replace: '   ', ' ' | strip %}


{% if change_model == 'get_size' %}{{- size -}}{% endif %}
{% if change_model == 'get_diff' %}{{ differentiator }}{% endif %}
{% if change_model == 'get_family' %}{{ family }}{% endif %}
{% if change_model == 'get_series' %}{{ series }}{% endif%}
 {% comment %}   
    # Remove the model number from the title
    if model_pattern_found
      assign model_removed_title = clean_title | replace: found_model, ''
      assign clean_title = model_removed_title
    endif
  endif
{% endcomment %}

{% comment %} Step 2: Remove everything after dash (including the dash) - conditional  
  if remove_after_dash and processed_title contains '-'
    assign dash_position = processed_title | split: '-' | first
    assign processed_title = dash_position
  endif
{% endcomment %}

{% comment %} Step 2b: Remove everything after with - conditional {% endcomment %}
{% comment %}
  if remove_after_dash and processed_title contains 'w/'
    assign dash_position = processed_title | split: 'w/' | first
    assign processed_title = dash_position
  endif
{% endcomment %}


{% comment %} Step 6: Handle model number positioning {% endcomment %}
{% comment %} 
  {% if change_model == 'move' and found_model != '' %}
    {% assign clean_title = found_model | append: ' ' | append: clean_title %}
  {% endif %}
{% endcomment %}