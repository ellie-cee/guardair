<div class="logos_column_container" data-section-id="{{ section.id }}">
  <div class="logos_wrapper">
    {% for block in section.blocks %}
      <div class="single_slide {% if block.settings.main %}main_logo_mobile{% endif %}">
        <div class="single_logo_column">
            {% if block.settings.icon != blank %}
                <div class="single_logo_logo">
                  <img {% if block.settings.main %} class="main_logo_image" {% endif %} src="{{ block.settings.icon | img_url: 'master' }}" alt="icon">
                </div>
            {% endif %}

            {% if block.settings.text != blank and block.settings.main == true %}
              <div><h2>{{ block.settings.text | strip_html }} <br> {{ block.settings.text-line-2 | strip_html }} </h2></div>
            {% endif %}

            {% if block.settings.text != blank and block.settings.main == false %}
              <div>{{ block.settings.text }}</div>
            {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
  
  {% comment %}Navigation dots for mobile{% endcomment %}
  <div class="carousel_dots"></div>
</div>

{% style %}
  #shopify-section-{{ section.id }} {background: {{ section.settings.background_color }};}
  #shopify-section-{{ section.id }} .single_logo_column > *, .single_logo_column h2 {color: {{ section.settings.text_color }} !important;}
  #shopify-section-{{ section.id }} .logos_column_container {display: flex; flex-direction: column; max-width: {{ section.settings.max_width | append: 'px' }}; padding: 3px 20px; margin: 0 auto; position: relative;}
  .logos_wrapper {display: flex; gap: 30px; justify-content: space-between; overflow: hidden; position: relative;}
  .single_slide {flex: 0 0 auto; transition: transform 0.3s ease;}
  .single_logo_column {display: flex; gap: 3px; align-items: center; height: 100%;}
  .single_logo_column img {width: 100%; height: auto; max-width: 50px;}
  .single_logo_column h2 {margin-left: -30px;}
  .single_logo_column p {font-size: 20px; display: flex; align-items: center; margin-bottom: 0px; font-family: Eurostile-Bol, serif;}
  .single_logo_column img.main_logo_image {max-width: 100%;}
  .single_logo_logo {display: flex; align-items: center;}
  .carousel_dots {display: none; justify-content: center; gap: 8px; margin-top: 15px;}
  .carousel_dot {width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,0.3); cursor: pointer; transition: background 0.3s ease;}
  .carousel_dot.active {background: {{ section.settings.text_color }};}
  
  @media only screen and (max-width: 1280px) {
    .logos_wrapper {overflow: hidden; scroll-snap-type: x mandatory; scroll-behavior: smooth;}
    .single_slide {flex: 0 0 100%; scroll-snap-align: start;}
    .single_logo_column {justify-content: center;}
    .single_logo_column img {max-width: 35px;}
    .single_logo_column p {font-size: 18px;}
    .main_logo_mobile {display: none;}
    #shopify-section-{{ section.id }} .logos_column_container {padding: 10px 0;}
    .carousel_dots {display: flex;}
  }
{% endstyle %}

<script>
  (function() {
    const container = document.querySelector('[data-section-id="{{ section.id }}"] .logos_column_container');
    const wrapper = container.querySelector('.logos_wrapper');
    const slides = container.querySelectorAll('.single_slide:not(.main_logo_mobile)');
    const dotsContainer = container.querySelector('.carousel_dots');
    
    if (window.innerWidth < 1280 && slides.length > 0) {
      let currentSlide = 0;
      
      {% comment %}Create dots{% endcomment %}
      slides.forEach((_, index) => {
        const dot = document.createElement('div');
        dot.className = `carousel_dot ${index === 0 ? 'active' : ''}`;
        dot.addEventListener('click', () => goToSlide(index));
        dotsContainer.appendChild(dot);
      });
      
      const dots = dotsContainer.querySelectorAll('.carousel_dot');
      
      function goToSlide(index) {
        currentSlide = index;
        wrapper.style.transform = `translateX(-${index * 100}%)`;
        
        {% comment %}Update dots{% endcomment %}
        dots.forEach((dot, i) => {
          dot.classList.toggle('active', i === index);
        });
      }
      
      function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        goToSlide(currentSlide);
      }
      
      {% comment %}Auto-advance every 4 seconds{% endcomment %}
      setInterval(nextSlide, 4000);
      
      {% comment %}Touch/swipe support{% endcomment %}
      let startX = 0;
      let currentX = 0;
      let isDragging = false;
      
      wrapper.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isDragging = true;
      });
      
      wrapper.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        currentX = e.touches[0].clientX;
        const diff = startX - currentX;
        
        if (Math.abs(diff) > 50) {
          if (diff > 0 && currentSlide < slides.length - 1) {
            goToSlide(currentSlide + 1);
          } else if (diff < 0 && currentSlide > 0) {
            goToSlide(currentSlide - 1);
          }
          isDragging = false;
        }
      });
      
      wrapper.addEventListener('touchend', () => {
        isDragging = false;
      });
    }
  })();
</script>

{% schema %}
  {
    "name": "Why Choose",
    "settings": [
      {
        "type": "color",
        "id": "background_color",
        "label": "Background Color",
        "default": "#121212"
      },
      {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#ffffff"
      },
      {
        "type": "range",
        "id": "max_width",
        "min": 1000,
        "max": 1600,
        "step": 20,
        "unit": "px",
        "label": "Max width",
        "default": 1160
      }
    ],
    "blocks": [
      {
        "name": "Icon",
        "type": "icon",
        "settings": [
          {
            "type": "image_picker",
            "id": "logo",
            "label": "Logo"
          },
          {
            "type": "richtext",
            "id": "text",
            "label": "Text Line 1"
          },
          {
            "type": "richtext",
            "id": "text-line-2",
            "label": "Text Line 2",
            "info": "Use for break in Main block only."
          },
          {
            "type": "checkbox",
            "id": "main",
            "label": "Main block",
            "default": false
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "GUA Icon Bar",
        "category": "Guardair",
        "settings": {}
      }
    ]
  }
{% endschema %}